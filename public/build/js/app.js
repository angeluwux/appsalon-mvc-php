function iniciarApp(){tabs(),mostrarSeccion(),botonesPaginacion(),paginaAnterior(),paginaSiguiente(),consultarAPI(),nombreCliente(),seleccionarFecha(),seleccionarHora(),mostrarResumen(),clienteId(),console.log(cita)}document.addEventListener("DOMContentLoaded",(()=>{iniciarApp()}));const cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};let paso=1;const pasoInicial=1,pasoFinal=3;function tabs(){document.querySelectorAll(".tabs button").forEach((e=>{e.addEventListener("click",(e=>{paso=parseInt(e.target.dataset.paso),mostrarSeccion(),botonesPaginacion()}))}))}function mostrarSeccion(){let e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar");let t=document.querySelector(".actual");t&&t.classList.remove("actual");let o=`#paso-${paso}`;document.querySelector(o).classList.add("mostrar"),document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function botonesPaginacion(){let e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");1===paso?(e.classList.add("ocultarNA"),t.classList.remove("ocultarNA")):2===paso?(e.classList.remove("ocultarNA"),t.classList.remove("ocultarNA")):3===paso&&(e.classList.remove("ocultarNA"),t.classList.add("ocultarNA"),mostrarResumen())}function paginaAnterior(){document.querySelector("#anterior").addEventListener("click",(()=>{paso--,paso<pasoInicial||(mostrarSeccion(),botonesPaginacion())}))}function paginaSiguiente(){document.querySelector("#siguiente").addEventListener("click",(()=>{paso++,paso>pasoFinal||(mostrarSeccion(),botonesPaginacion())}))}async function consultarAPI(){try{const e="/api/servicios",t=await fetch(e);mostrarServicios(await t.json())}catch(e){console.log(e)}}function mostrarServicios(e){e.forEach((e=>{const{id:t,nombre:o,precio:a}=e,n=document.createElement("P");n.classList.add("nombre-servicio"),n.textContent=`${o}`;const c=document.createElement("P");c.classList.add("precio-servicio"),c.textContent=`$/. ${a}`;const r=document.createElement("DIV");r.classList.add("servicio"),r.dataset.idServicio=t,r.appendChild(n),r.appendChild(c),r.onclick=()=>{seleccionarServicio(e)};document.querySelector("#servicios").appendChild(r)}))}function seleccionarServicio(e){const{servicios:t}=cita,{id:o}=e;let a=document.querySelector(`[data-id-servicio="${o}"]`),n=t.some((e=>e.id===o));cita.servicios=n?t.filter((e=>e.id!==o)):[...t,e],a.classList.toggle("seleccionado")}function nombreCliente(){cita.nombre=document.querySelector("#nombre").value}function clienteId(){cita.id=document.querySelector("#id").value}function crearAlerta(e,t,o,a=!0){const n=document.createElement("P"),c=document.querySelector(o);n.textContent=e,n.classList.add("alerta"),n.classList.add(t),borrarAlertaPrevia(),c.appendChild(n),a&&borrarAlertaActual(n)}function seleccionarFecha(){let e=document.querySelector("#fecha");e.addEventListener("input",(t=>{let o=new Date(t.target.value).getUTCDay();6===o||0===o?(crearAlerta("No se puede seleccionar sábados ni domingos","error",".formulario"),e.value=""):cita.fecha=t.target.value}))}function seleccionarHora(){document.querySelector("#hora").addEventListener("input",(e=>{const t=e.target.value,o=t.split(":")[0];o<=10||o>=20?(e.target.value="",crearAlerta("El horario seleccionado no es válido","error",".formulario"),cita.hora=""):cita.hora=t}))}function borrarAlertaPrevia(){const e=document.querySelector(".alerta");e&&e.remove()}function borrarAlertaActual(e){setTimeout((()=>{e.remove()}),3e3)}function mostrarResumen(){let e=document.querySelector(".contenido-resumen"),t=document.querySelector(".cliente-cita");if(e.innerHTML="",t.innerHTML="",Object.values(cita).includes("")||0===cita.servicios.length)return void crearAlerta("Faltan datos para poder procesar su cita","error",".contenido-resumen",!1);const o=document.createElement("H3");o.textContent="Resumen de servicios",e.appendChild(o);const{nombre:a,fecha:n,hora:c,servicios:r}=cita;r.forEach((t=>{const{nombre:o,precio:a}=t,n=document.createElement("DIV");n.classList.add("contenedor-servicio");const c=document.createElement("P");c.textContent=o;const r=document.createElement("P");r.innerHTML=`<span>Precio:</span> $${a}`,n.appendChild(c),n.appendChild(r),e.appendChild(n)}));const i=document.querySelector(".cliente-cita"),s=document.createElement("H3");s.textContent="Resumen de cita",i.appendChild(s);const l=document.createElement("P");l.innerHTML=`<span>Nombre:</span> ${a}`;const d=formatearFecha(n),u=document.createElement("P");u.innerHTML=`<span>Fecha:</span> ${d}`;const m=document.createElement("P");m.innerHTML=`<span>Hora:</span> ${c}`;const p=document.createElement("BUTTON");p.classList.add("boton"),p.textContent="Reservar cita",p.onclick=()=>{reservarCita()},i.appendChild(l),i.appendChild(u),i.appendChild(m),i.appendChild(p)}function formatearFecha(e){const t=new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}async function reservarCita(){const{id:e,nombre:t,fecha:o,hora:a,servicios:n}=cita,c=n.map((e=>e.id)),r=new FormData;r.append("fecha",o),r.append("hora",a),r.append("usuarioId",e),r.append("servicios",c);try{const e="/api/citas",t=await fetch(e,{method:"post",body:r}),o=await t.json();console.log(o),o.resultado&&Swal.fire({icon:"success",title:"Cita correctamente",text:"Tu cita fue creada correctamente",button:"OK"}).then((()=>{setTimeout((()=>{window.location.reload()}),3e3)}))}catch(e){Swal.fire({icon:"error",title:"Error",text:"Hubo un error al procesar su cita"})}}